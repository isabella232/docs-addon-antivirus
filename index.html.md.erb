---
title: ClamAV for PCF
owner: Security Engineering
---

<strong><%= modified_date %></strong>

This topic is an overview of <%= vars.product_full %>.

## <a id="about-clamav"></a>About ClamAV for PCF

ClamAV for PCF might be necessary for regulatory purposes if your compliance auditor
requires antivirus protection within your PCF environment.

For example, auditors sometimes expect that antivirus protection is present in an
environment that must comply with standards such as the Payment Card Industry Data
Security Standard (PCI DSS) or Health Insurance Portability and Accountability Act (HIPAA).

## <a id='snapshot'></a> Product Snapshots

The following table provides version and version-support information about <%= vars.product_short %>.

<table class="nice">
    <th>Element</th>
    <th>Details</th>
    <tr>
        <td>Version</td>
        <td>1.5.0</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td>MMMMM XX, 2019</td>
    </tr>
    <tr>
        <td>Software component version</td>
        <td>Open Source ClamAV 0.101.2</td>
    </tr>
    <tr>
        <td>Compatible Ops Manager versions</td>
        <td>2.2, 2.3, and 2.4</td>
    </tr>
    <tr>
        <td>Compatible Pivotal Application Service (PAS) versions</td>
        <td>2.3 and 2.4</td>
    </tr>
    <tr>
        <td>Compatible Enterprise Pivotal Container Service (PKS) versions</td>
        <td>1.2 and later</td>
    </tr>
    <tr>
        <td>Compatible BOSH stemcells</td>
        <td>Ubuntu Xenial and Trusty, Windows 2016, and 2012</td>
    </tr>
    <tr>
        <td>IaaS support</td>
        <td>vSphere, GCP, AWS, Azure, and OpenStack</td>
    </tr>
</table>

This version of the <%= vars.product_short %> is compatible with Canonical Ubuntu 16.04 (Xenial) stemcells.

The following table provides version and version-support information about ClamAV Mirror for PCF.

<table class="nice">
    <th>Element</th>
    <th>Details</th>
    <tr>
        <td>Version</td>
        <td>1.5.0</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td>MMMMM XX, 2019</td>
    </tr>
    <tr>
        <td>Compatible Ops Manager versions</td>
        <td>2.2, 2.3, and 2.4</td>
    </tr>
    <tr>
        <td>Compatible Pivotal Application Service (PAS) versions</td>
        <td>2.3 and 2.4</td>
    </tr>
    <tr>
        <td>Compatible Enterprise Pivotal Container Service (PKS) versions</td>
        <td>1.2 and later</td>
    </tr>
    <tr>
        <td>Compatible BOSH stemcells</td>
        <td>Ubuntu Xenial and Trusty</td>
    </tr>
    <tr>
        <td>IaaS support</td>
        <td>vSphere, GCP, AWS, and OpenStack</td>
    </tr>
</table>

This version of the ClamAV Mirror for PCF is compatible with Canonical Ubuntu 16.04 (Xenial) stemcells.

##<a id="architecture"></a> ClamAV Architecture
###<a id="propagate"></a>How Virus Definitions Propagate to VMs

Virus definitions on PCF internal ClamAV Mirror update automatically or manually depending on whether PCF is on an online or airgapped network, as described in [Update Virus Definitions](#update) above.
The automatic and manual processes store new virus definitions to the ClamAV
mirror VM's database of unverified viruses as follows:

* **Automatic update**: The `freshclam` daemon process on the ClamAV Mirror VM downloads the virus definitions
and stores them in the internal mirror VM's unverified database.
* **Manual update**: The operator runs `bosh scp` to directly copy the virus definitions
to the internal mirror's database of unverified viruses.

From the unverified internal mirror database, virus definitions then propagate to BOSH VMs as follows:

1. The database verifier process on the ClamAV mirror verifies the date, format, and integrity of the new virus definitions.
  - To verify integrity, the verifier checks bytecode signatures against signatures in the external ClamAV database, using the external database public key.
  - If verification fails or if the virus definitions are not new, the mirror VM generates an error.
  See [Virus Database Update Issues](./troubleshooting.html#updates).

1. The internal ClamAV mirror VM saves verified virus definitions to its verified database
and serves them to the `freshclam` processes of BOSH VMs.

1. On each BOSH-managed VM:

  1. The `freshclam` daemon process regularly queries the internal ClamAV mirror for new virus definitions.
      - You can configure the query frequency in the ClamAV for PCF tile >
  **ClamAV Configuration** pane > **Number of database checks per day** field.

  1. When `freshclam` retrieves new definitions, it:
      - Notifies the `clamd` daemon process that there are new definitions, and
      -  Saves the virus definitions in the BOSH VM's own virus DB.

  1. The `clamd` process loads the new virus definitions into active memory
  to enable fast scanning by the `clamscan` process.

The diagrams below illustrate how new virus definitions propagate
from an external ClamAV database to BOSH VMs, in online and airgapped PCF installations.

###<a id="propagate-online"></a>Online Network

This diagram illustrates how virus definitions propagate to BOSH VMs in an online network:

[//]: https://docs.google.com/presentation/d/1pBHK0dcE5y7rT4KnacqFDc6LuU8R3HiR9ApuvwY1uzA/edit
![Diagram shows online (non-airgapped) update process, following path of new virus data.  External ClamAV DB in cloud serves new virus data to freshclam running on local ClamAV Mirror.  The local mirror runs it through the DB verifier, also on ClamAV mirror, and then serves it to freshclam on all BOSH VMs.  On each BOSH VM, freshclam notifies clamd that there are new definitions, and saves the def's in the virus DB.  clamd then loads the new virus def's from the DB into its memory to enable fast scanning.](update-defs-online.png)

###<a id="propagate-airgap"></a>Airgapped Network

This diagram illustrates how virus definitions propagate to BOSH VMs in an airgapped network:

[//]: https://docs.google.com/presentation/d/1pBHK0dcE5y7rT4KnacqFDc6LuU8R3HiR9ApuvwY1uzA/edit
![Diagram shows airgapped update process, following path of new virus data.  Operator downloads virus data from External ClamAV DB in cloud, then runs BOSH SCP to send it to freshclam running on local ClamAV Mirror.  The local mirror runs it through the DB verifier, also on ClamAV mirror, and then serves it to freshclam on all BOSH VMs.  On each BOSH VM, freshclam notifies clamd that there are new definitions, and saves the def's in the virus DB.  clamd then loads the new virus def's from the DB into its memory to enable fast scanning.](update-defs-airgap.png)
